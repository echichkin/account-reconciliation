# account-reconciliation
Скрипт для бухгалтеров - сводим балансы в Excel на основании выгрузок из 1С.

## Название проекта

Сверка счетов 62 и 76 в Excel с помощью Power Query

## Описание

Этот проект содержит готовый Power Query‑скрипт и Excel‑файл для автоматизации сверки оборотно‑сальдовых ведомостей по счетам 62 и 76. Скрипт загружает выгрузки из 1С, очищает данные, объединяет таблицы, рассчитывает ожидаемые авансы по двум схемам (20% и 10%) и показывает только строки с расхождениями, которые требуют проверки.

Решение ориентировано на бухгалтеров и разработчиков, которые хотят сократить ручную сверку и снизить риск ошибок при работе с большим количеством контрагентов.

## Возможности

- Автоматическая загрузка всех файлов Оборотно‑сальдовой ведомости по счетам 62 и 76 из указанной папки.
- Объединение нескольких выгрузок в две большие таблицы (по 62 и по 76 счёту).
- Очистка служебных строк, шапок, итогов и «мусорных» значений.
- Приведение дат к нормальному виду и определение отчётного периода.
- Объединение данных по 62 и 76 счетам по контрагенту.
- Расчёт ожидаемых авансов по схемам 20% и 10/110 и сравнение с фактическими данными.
- Выделение только проблемных операций с превышением порога расхождения.

## Структура репозитория

Предполагаемая структура (можешь подправить под свой репо):

- `Сверка.xlsx` — основной файл Excel с подключённым Power Query‑скриптом.
- `src/` — при необходимости: .pq или .txt с кодом Power Query.  
- `examples/` — примеры выгрузок Оборотно‑сальдовой ведомости из 1С (обезличенные/тестовые).  
- `docs/` — дополнительные материалы, скриншоты, описание логики.  

## Требования

- Microsoft Excel с поддержкой Power Query (Excel 2016 и новее или Excel 365).
- Выгрузки Оборотно‑сальдовой ведомости по счетам 62 и 76 из 1С в формате Excel (`.xls`/`.xlsx`).

## Как использовать

1. Скопируйте файл `Сверка.xlsx` в папку с выгрузками из 1С (Оборотно‑сальдовые ведомости по 62 и 76 счетам).
2. Откройте `Сверка.xlsx` в Excel.  
3. На листе `Инфо` убедитесь, что путь к папке определяется корректно (формула получает путь к текущему файлу).
4. Нажмите «Обновить всё» в Excel на вкладке "Данные" (или нажмите Ctrl + Alt + F5).
5. Перейдите на лист с результатами сверки и посмотрите таблицу с расхождениями.

## Интерпретация результата

- В таблице выводятся только операции, где есть расхождения по авансам.
- Столбец «Расхождения» показывает величину несоответствия между расчётным авансом (по схеме 20% или 10/110) и фактической суммой по счёту 76.
- Если указано число — это величина расхождения в рублях с учётом порога.  
- Если указано «Требуется проверка» — ни одна схема не попала в допуск, операцию нужно проверить в 1С вручную.

## Логика расчётов (кратко)

- Счёт 62 — авансы, полученные от покупателя.
- Счёт 76 — расчёты с покупателями (остаток задолженности).
- Поддерживаются две типовые схемы авансов:  
  - 20% аванс: аванс = сумма контракта / 6.
  - 10% аванс с НДС: аванс = (сумма * 10) / 110.
- Если расхождение по одной из схем превышает заданный порог, операция попадает в отчёт.

## Ограничения и заметки

- Скрипт заточен под конкретный формат выгрузки из 1С (структура колонок, названия, язык). При изменении формата отчёта запросы могут потребовать адаптации.
- Порог расхождения задаётся в параметрах Power Query и может быть изменён под требования компании.
- Решение тестировалось на данных с большим количеством контрагентов (до миллионов строк в сумме).

## Как адаптировать под себя

- Изменить фильтры по именам файлов (если отчёты называются иначе).
- Подстроить названия столбцов под свой шаблон Оборотно‑сальдовой ведомости.
- Изменить порог сходимости и при необходимости добавить свои схемы расчёта авансов.

## Обратная связь

Если вы бухгалтер и используете этот подход в работе — дайте знать, какие ещё типовые сверки было бы полезно автоматизировать. Если вы разработчик и нашли, как улучшить логику или производительность запросов, присылайте issue или pull request.
